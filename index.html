<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Home IoT Control</title>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f1f1f1;
  margin: 0;
  padding: 0;
}

.container {
  width: 95%;
  max-width: 500px;
  margin: 20px auto;
  padding: 15px;
  background: white;
  border-radius: 10px;
  box-shadow: 0px 0px 10px #aaa;
}

h2 {
  text-align: center;
  margin-top: 0;
}

button {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  font-size: 18px;
  border: none;
  color: white;
  border-radius: 6px;
  cursor: pointer;
}

.onBtn { background: #28a745; }
.offBtn { background: #dc3545; }
.logout { background: #444; margin-top: 30px; }

.fanControl {
  width: 100%;
  margin-top: 20px;
}

select {
  width: 100%;
  padding: 10px;
  font-size: 18px;
  border-radius: 6px;
}
</style>

</head>
<body>

<div class="container" id="loginBox">
  <h2>Home IoT Login</h2>
  <input id="email" type="text" placeholder="Email" style="width:100%;padding:10px;margin-top:10px;font-size:17px;" />
  <input id="password" type="password" placeholder="Password" style="width:100%;padding:10px;margin-top:10px;font-size:17px;" />
  
  <button id="loginBtn" class="onBtn">Login</button>
  <button id="signupBtn" class="offBtn">Sign Up</button>
</div>


<div class="container" id="controlBox" style="display:none;">
  <h2>Smart Home Control</h2>

  <!-- BULBS -->
  <button onclick="setBulb(1, 'ON')" class="onBtn">Bulb 1 ON</button>
  <button onclick="setBulb(1, 'OFF')" class="offBtn">Bulb 1 OFF</button>

  <button onclick="setBulb(2, 'ON')" class="onBtn">Bulb 2 ON</button>
  <button onclick="setBulb(2, 'OFF')" class="offBtn">Bulb 2 OFF</button>

  <button onclick="setBulb(3, 'ON')" class="onBtn">Bulb 3 ON</button>
  <button onclick="setBulb(3, 'OFF')" class="offBtn">Bulb 3 OFF</button>

  <button onclick="setBulb(4, 'ON')" class="onBtn">Bulb 4 ON</button>
  <button onclick="setBulb(4, 'OFF')" class="offBtn">Bulb 4 OFF</button>


  <!-- FAN -->
  <h3>Fan Speed</h3>
  <select id="fanSpeed" class="fanControl" onchange="setFan()">
    <option value="0">OFF</option>
    <option value="1">LOW</option>
    <option value="2">MEDIUM</option>
    <option value="3">HIGH</option>
  </select>

  <button class="logout" onclick="logout()">Logout</button>
</div>


<script>
// -------------------------------------------------------
// Firebase Config
// -------------------------------------------------------
const firebaseConfig = {
  apiKey: "AIzaSyCKdiZHxSO-zzuPukuov5uzrTixfaWX5aA",
  authDomain: "home-iot-24e19.firebaseapp.com",
  databaseURL: "https://home-iot-24e19-default-rtdb.firebaseio.com",
  projectId: "home-iot-24e19",
  storageBucket: "home-iot-24e19.appspot.com",
  messagingSenderId: "1056489515184",
  appId: "1:1056489515184:web:xxxxxxx"
};

// Initialize Firebase
const app = firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const auth = firebase.auth();

// -------------------------------------------------------
// AUTHENTICATION
// -------------------------------------------------------
document.getElementById("loginBtn").onclick = () => {
  const email = email.value;
  const pass = password.value;

  auth.signInWithEmailAndPassword(email, pass)
  .then(() => {
    loginBox.style.display = "none";
    controlBox.style.display = "block";
  })
  .catch(err => alert(err.message));
};

document.getElementById("signupBtn").onclick = () => {
  const email = email.value;
  const pass = password.value;

  auth.createUserWithEmailAndPassword(email, pass)
  .then(() => alert("Account Created! Login now."))
  .catch(err => alert(err.message));
};

function logout() {
  auth.signOut();
  controlBox.style.display = "none";
  loginBox.style.display = "block";
}

// Auto login state check
auth.onAuthStateChanged(user => {
  if (user) {
    loginBox.style.display = "none";
    controlBox.style.display = "block";
  } else {
    controlBox.style.display = "none";
    loginBox.style.display = "block";
  }
});


// -------------------------------------------------------
// BULB CONTROL
// -------------------------------------------------------
function setBulb(num, state) {
  firebase.database().ref("/bulb" + num).set(state);
}

// -------------------------------------------------------
// FAN CONTROL
// -------------------------------------------------------
function setFan() {
  let speed = document.getElementById("fanSpeed").value;
  firebase.database().ref("/fan").set(Number(speed));
}


// -------------------------------------------------------
// REALTIME LISTENER (Auto Update UI when ESP changes)
// -------------------------------------------------------
for (let i = 1; i <= 4; i++) {
  firebase.database().ref("/bulb" + i).on("value", snap => {
    console.log("Bulb " + i + " => " + snap.val());
  });
}

firebase.database().ref("/fan").on("value", snap => {
  document.getElementById("fanSpeed").value = snap.val();
});
</script>

</body>
</html>
